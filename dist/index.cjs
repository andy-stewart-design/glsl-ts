"use strict";var d=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var $=(t,i)=>{for(var r in i)d(t,r,{get:i[r],enumerable:!0})},O=(t,i,r,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of F(i))!N.call(t,s)&&s!==r&&d(t,s,{get:()=>i[s],enumerable:!(e=z(i,s))||e.enumerable});return t};var W=t=>O(d({},"__esModule",{value:!0}),t);var B={};$(B,{default:()=>f});module.exports=W(B);function u(t){return typeof t=="number"}function p(t){return typeof t=="string"}function x(t){return typeof t=="boolean"}function b(t){return Array.isArray(t)&&t.length===2&&t.every(u)}function E(t){return Array.isArray(t)&&t.length===3&&t.every(u)}function L(t){return Array.isArray(t)&&t.length===4&&t.every(u)}function S(t){let i=[".jpg",".jpeg",".png",".avif",".webp"],r=t.toLowerCase();return i.some(e=>r.endsWith(e))}function w(t){let i=[".mp4",".webm",".mov"],r=t.toLowerCase();return i.some(e=>r.endsWith(e))}function C(t){let i=t.getContext("webgl2");if(!i)throw new Error("WebGL not supported");return i}function m(t,i){let{TEXTURE_2D:r,RGBA:e,UNSIGNED_BYTE:s}=t,n=new Uint8Array([0,0,0,255]);i?t.texImage2D(t.TEXTURE_2D,0,e,e,s,i):t.texImage2D(r,0,e,1,1,0,e,s,n)}function v(t,i){_(i.width)&&_(i.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))}function _(t){return t>0&&(t&t-1)===0}function h(t){return typeof t=="string"?S(t)?{valid:!0,type:"image",value:t}:w(t)?{valid:!0,type:"video",value:t}:t==="webcam"?{valid:!0,type:"webcam",value:t}:!isNaN(Number(t))&&t.includes(".")?{valid:!0,type:"float",value:parseFloat(t)}:!isNaN(Number(t))&&!t.includes(".")?{valid:!0,type:"int",value:parseInt(t)}:{valid:!1,message:`Unknown uniform type: ${t}`}:Array.isArray(t)?t.length>=2&&t.length<=4?{valid:!0,type:`vec${t.length}`,value:t}:{valid:!1,message:`Invalid vector length: ${t.length}`}:typeof t=="number"?{valid:!0,type:"float",value:t}:typeof t=="boolean"?{valid:!0,type:"bool",value:t}:{valid:!1,message:`Unknown uniform type: ${t}`}}function c(t,i){return`[GLSL.TS]: Couldn't update ${t}, value must be a ${i}`}function R(t,i,r){if(r==="snake")return`${i}_${t}`;{let e=t.charAt(0).toUpperCase()+t.slice(1);return`${i}${e}`}}var T=class{constructor(i,r,e,s,n){this.uniforms=new Map;this.staticTextures=new Map;this.dynamicTextures=new Map;this.uniformPrefix="u";this.uniformCase="snake";this.gl=i,this.program=r,this.uniformPrefix=s,this.uniformCase=n,this.initializeDefaultUniforms(),this.initializeCustomUniforms(e)}initializeDefaultUniforms(){let i=this.formatUniform("time"),r=this.gl.getUniformLocation(this.program,i);r&&this.uniforms.set(i,{type:"float",location:r});let e=this.formatUniform("resolution"),s=this.gl.getUniformLocation(this.program,e);s&&this.uniforms.set(e,{type:"vec2",location:s});let n=this.formatUniform("mouse"),o=this.gl.getUniformLocation(this.program,n);o&&this.uniforms.set(n,{type:"vec2",location:o})}initializeCustomUniforms(i){for(let[r,e]of Object.entries(i)){let s=this.formatUniform(r),n=this.gl.getUniformLocation(this.program,s);if(!n){console.warn(`[GLSL.TS]: couldn't init uniform (${s}). Most likely, it was not used in shader and was optimized out.`);continue}let o=h(e);if(!o.valid){console.error(o.message);continue}this.uniforms.set(s,{type:o.type,location:n}),this.setUniformValue(r,o.value)}}setUniformValue(i,r){let e=this.formatUniform(i),s=this.uniforms.get(e);if(!s){console.warn(`[GLSL.TS]: uniform ${i} not found`);return}let{type:n,location:o}=s;switch(n){case"float":u(r)?this.gl.uniform1f(o,r):console.warn(c(e,"number"));break;case"vec2":b(r)?this.gl.uniform2fv(o,r):console.warn(c(e,"Vec2"));break;case"vec3":E(r)?this.gl.uniform3fv(o,r):console.warn(c(e,"Vec3"));break;case"vec4":L(r)?this.gl.uniform4fv(o,r):console.warn(c(e,"Vec4"));break;case"int":u(r)?this.gl.uniform1i(o,r):console.warn(c(e,"number"));break;case"bool":x(r)?this.gl.uniform1i(o,r?1:0):console.warn(c(e,"boolean"));break;case"image":p(r)?this.loadStaticTexture(e,r):console.warn(c(e,"string"));break;case"video":p(r)?this.loadDynamicTexture(e,r):console.warn(c(e,"string"));break;case"webcam":this.loadDynamicTexture(e);break;default:console.warn(`Unsupported uniform type for ${e}`)}}formatUniform(i){return R(i,this.uniformPrefix,this.uniformCase)}getTextureUnit(){return this.staticTextures.size+this.dynamicTextures.size}getUniformLocation(i){let r=this.gl.getUniformLocation(this.program,i);if(!r)throw new Error(`Failed to retrieve unform loaction for ${i}`);return r}initializeTexture(i){let r=this.getUniformLocation(i),e=this.gl.createTexture(),s=this.getTextureUnit();return this.gl.uniform1i(r,s),this.gl.activeTexture(this.gl.TEXTURE0+s),this.gl.bindTexture(this.gl.TEXTURE_2D,e),m(this.gl),[e,s]}loadStaticTexture(i,r){let[e,s]=this.initializeTexture(i),n=this.uniformCase==="snake"?`${i}_resolution`:`${i}Resolution`,o=this.gl.getUniformLocation(this.program,n);this.staticTextures.set(i,{asset:e,unit:s}),o&&this.uniforms.set(n,{type:"vec2",location:o});let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{try{let l=this.staticTextures.get(i);if(l){o?(this.uniforms.set(n,{type:"vec2",location:o}),this.gl.uniform2f(o,a.width,a.height)):console.info(`[GLSL.TS]: Could not set "${n}" Uniform. Most likely, it was not used in shader and was optimized out.`),this.gl.activeTexture(this.gl.TEXTURE0+l.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,l.asset),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),v(this.gl,a),m(this.gl,a);let g=this.getUniformLocation(i);this.gl.uniform1i(g,l.unit)}else console.warn(`[GLSL.TS]: no texture found for name: ${i}`)}catch(l){console.error(`[GLSL.TS]: error loading texture ${i}:`,l)}},a.onerror=l=>{console.error(`[GLSL.TS]: error loading texture ${i}:`,l)},a.src=r}async loadDynamicTexture(i,r){let e=document.createElement("video");if(e.muted=!0,e.autoplay=!0,e.playsInline=!0,console.log("VIDEO LOADING"),e.onloadeddata=()=>{console.log("VIDEO LOADED");let[s,n]=this.initializeTexture(i),o=this.uniformCase==="snake"?`${i}_resolution`:`${i}Resolution`,a=this.gl.getUniformLocation(this.program,o);a&&this.uniforms.set(o,{type:"vec2",location:a}),this.dynamicTextures.set(i,{video:e,asset:s,unit:n}),e.play();try{let l=this.dynamicTextures.get(i);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),l&&(a?(this.uniforms.set(o,{type:"vec2",location:a}),this.gl.uniform2f(a,e.videoWidth,e.videoHeight)):console.info(`[GLSL.TS]: Could not set "${o}" Uniform. Most likely, it was not used in shader and was optimized out.`),this.gl.activeTexture(this.gl.TEXTURE0+l.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,l.asset),v(this.gl,l.video),m(this.gl,l.video))}catch(l){console.error(`[GLSL.TS]: Error loading texture ${i}:`,l)}},e.onerror=()=>{console.error(`[GLSL.TS]: Failed to load texture: ${r}`)},r)e.loop=!0,e.crossOrigin="anonymous",e.src=r;else{let s=await navigator.mediaDevices.getUserMedia({video:!0});e.srcObject=s}}renderDynamicTextures(){for(let i of Array.from(this.dynamicTextures.values()))this.gl.activeTexture(this.gl.TEXTURE0+i.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,i.asset),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i.video)}destroy(){this.staticTextures.forEach(i=>this.gl.deleteTexture(i.asset)),this.staticTextures.clear();for(let i of Array.from(this.dynamicTextures.values())){let r=i.video.srcObject;r instanceof MediaStream?r.getTracks().forEach(e=>e.stop()):i.video.srcObject=null}this.dynamicTextures.clear()}},A=T;var V=`
    attribute vec2 a_position;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }
  `,P=`#version 300 es
    in vec2 a_position;
    
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }`,I=`
    #ifdef GL_ES
    precision mediump float;
    #endif

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `,D=`#version 300 es
    precision mediump float;

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    out vec4 outColor;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      outColor = vec4(color, 1.0);
    }
  `;var U=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),y=class{constructor(i,r,e){this.container=i,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width=this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.gl=C(this.canvas),this.gl.clearColor(0,0,0,1),"drawingBufferColorSpace"in this.gl&&(this.gl.drawingBufferColorSpace="display-p3"),"unpackColorSpace"in this.gl&&(this.gl.unpackColorSpace="display-p3");let s=r===3?D:I,n=r===3?P:V,o=this.compileShader(n,"vert"),a=this.compileShader(e??s,"frag");this.program=this.createProgram(o,a),this.gl.useProgram(this.program),this.createBuffer(U);let l=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,this.gl.FLOAT,!1,0,0)}compileShader(i,r){let e=this.gl.createShader(r==="frag"?this.gl.FRAGMENT_SHADER:this.gl.VERTEX_SHADER);if(!e)throw new Error("Shader creation failed");if(this.gl.shaderSource(e,i),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)){let s=`Shader compilation error: ${this.gl.getShaderInfoLog(e)}`;throw this.gl.deleteShader(e),new Error(s)}return e}createProgram(i,r){let e=this.gl.createProgram();if(this.gl.attachShader(e,i),this.gl.attachShader(e,r),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))throw new Error(`Program linking error: ${this.gl.getProgramInfoLog(e)}`);return e}createBuffer(i){let r=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),r}resizeCanvas(){let i=this.container.getBoundingClientRect();this.canvas.width=i.width,this.canvas.height=i.height}destroy(){this.container.innerHTML=""}},G=y;var f=class extends G{constructor({container:r,frag:e,uniforms:s={},uniformPrefix:n="u",uniformCase:o="snake",glVersion:a=3}){super(r,a,e);this.mousePos=[0,0];this.controller=new AbortController;this.resizeObserver=null;this.rafId=null;this.startTime=null;this.pauseStartTime=null;this.lastRenderTime=0;this.totalPausedTime=0;this.assets=new A(this.gl,this.program,s,n,o),this.handleResize(),this.addEventListeners()}render(r,e=!0){if(this.startTime===null)return;this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.lastRenderTime=r;let s=this.assets.uniforms.get(this.assets.formatUniform("time"));if(s){let a=r-this.totalPausedTime-this.startTime;this.gl.uniform1f(s.location,a*.001)}let n=this.assets.uniforms.get(this.assets.formatUniform("mouse"));n&&this.gl.uniform2f(n.location,this.mousePos[0],this.mousePos[1]),this.assets.renderDynamicTextures(),this.gl.drawArrays(this.gl.TRIANGLES,0,U.length/2),e&&(this.rafId=requestAnimationFrame(o=>this.render(o)))}handleResize(){super.resizeCanvas();let r=this.assets.formatUniform("resolution"),e=this.assets.uniforms.get(r)??null;if(!e){console.warn(`Could not find resolution uniform (${r}) location when resizing canvas`);return}this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.uniform2f(e.location,this.canvas.width,this.canvas.height),this.render(this.lastRenderTime,!1)}addEventListeners(){let{signal:r}=this.controller;this.canvas.addEventListener("mousemove",e=>{let s=this.canvas.getBoundingClientRect();this.mousePos[0]=e.clientX-s.left,this.mousePos[1]=s.height-(e.clientY-s.top)},{signal:r}),this.canvas.addEventListener("touchmove",e=>{let{clientX:s,clientY:n}=e.touches[0],o=this.canvas.getBoundingClientRect();this.mousePos[0]=s-o.left,this.mousePos[1]=o.height-(n-o.top)},{signal:r}),this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container)}play(r=!0){this.paused&&(this.pauseStartTime!==null?(this.totalPausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null):this.totalPausedTime=performance.now(),this.startTime===null&&(this.startTime=performance.now()),this.assets.dynamicTextures.size>0&&this.assets.dynamicTextures.forEach(e=>{e.video.play()}),r?this.rafId=requestAnimationFrame(e=>this.render(e,r)):this.render(performance.now(),r))}pause(){typeof this.rafId!="number"||this.paused||(this.pauseStartTime=performance.now(),cancelAnimationFrame(this.rafId),this.rafId=null,this.assets.dynamicTextures.size>0&&this.assets.dynamicTextures.forEach(r=>{r.video.pause()}))}updateUniform(r,e){let s=h(e);if(!s.valid){console.warn(s.message);return}this.assets.setUniformValue(r,s.value)}destroy(){super.destroy(),this.assets.destroy(),this.controller.abort(),this.resizeObserver?.unobserve(this.container),this.resizeObserver?.disconnect()}get paused(){return this.rafId===null}get uniforms(){let r=Object.fromEntries(this.assets.uniforms),s=Object.entries(r).map(([n,{location:o,type:a}])=>{switch(a){case"vec2":case"vec3":case"vec4":let l=this.gl.getUniform(this.program,o);return[n,Array.from(l)];case"image":let g=this.assets.staticTextures.get(n);return[n,g?.asset];case"video":case"webcam":let M=this.assets.dynamicTextures.get(n);return[n,M?.asset];default:let k=this.gl.getUniform(this.program,o);return[n,k]}});return Object.fromEntries(s)}};
//# sourceMappingURL=index.cjs.map