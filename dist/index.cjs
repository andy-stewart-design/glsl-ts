"use strict";var g=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var F=(e,t)=>{for(var i in t)g(e,i,{get:t[i],enumerable:!0})},W=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of D(t))!M.call(e,s)&&s!==i&&g(e,s,{get:()=>t[s],enumerable:!(r=$(t,s))||r.enumerable});return e};var k=e=>W(g({},"__esModule",{value:!0}),e);var z={};F(z,{default:()=>f});module.exports=k(z);function u(e){return typeof e=="number"}function d(e){return typeof e=="string"}function y(e){return typeof e=="boolean"}function E(e){return Array.isArray(e)&&e.length===2&&e.every(u)}function U(e){return Array.isArray(e)&&e.length===3&&e.every(u)}function b(e){return Array.isArray(e)&&e.length===4&&e.every(u)}function L(e){let t=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".tiff",".ico"],i=e.toLowerCase();return t.some(r=>i.endsWith(r))}function S(e){let t=[".mp4",".avi",".mov",".mkv",".wmv",".flv",".webm",".ts"],i=e.toLowerCase();return t.some(r=>i.endsWith(r))}function _(e){let t=e.getContext("webgl2");if(!t)throw new Error("WebGL not supported");return t}function h(e,t){let{TEXTURE_2D:i,RGBA:r,UNSIGNED_BYTE:s}=e,n=new Uint8Array([0,0,0,255]);t?e.texImage2D(e.TEXTURE_2D,0,r,r,s,t):e.texImage2D(i,0,r,1,1,0,r,s,n)}function p(e,t){w(t.width)&&w(t.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR))}function w(e){return e>0&&(e&e-1)===0}function m(e){return typeof e=="string"?L(e)?{valid:!0,type:"image",value:e}:S(e)?{valid:!0,type:"video",value:e}:e==="webcam"?{valid:!0,type:"webcam",value:e}:!isNaN(Number(e))&&e.includes(".")?{valid:!0,type:"float",value:parseFloat(e)}:!isNaN(Number(e))&&!e.includes(".")?{valid:!0,type:"int",value:parseInt(e)}:{valid:!1,message:`Unknown uniform type: ${e}`}:Array.isArray(e)?e.length>=2&&e.length<=4?{valid:!0,type:`vec${e.length}`,value:e}:{valid:!1,message:`Invalid vector length: ${e.length}`}:typeof e=="number"?{valid:!0,type:"float",value:e}:typeof e=="boolean"?{valid:!0,type:"bool",value:e}:{valid:!1,message:`Unknown uniform type: ${e}`}}function c(e,t){return`[GLSL.TS]: Couldn't update ${e}, value must be a ${t}`}var v=class{constructor(t,i,r,s){this.uniforms=new Map;this.staticTextures=new Map;this.dynamicTextures=new Map;this.uniformPrefix="u_";this.gl=t,this.program=i,this.uniformPrefix=s,this.initializeDefaultUniforms(),this.initializeCustomUniforms(r)}initializeDefaultUniforms(){let t=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}time`);t&&this.uniforms.set(`${this.uniformPrefix}time`,{type:"float",location:t});let i=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}resolution`);i&&this.uniforms.set(`${this.uniformPrefix}resolution`,{type:"vec2",location:i});let r=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}mouse`);r&&this.uniforms.set(`${this.uniformPrefix}mouse`,{type:"vec2",location:r})}initializeCustomUniforms(t){for(let[i,r]of Object.entries(t)){let s=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}${i}`);if(!s){console.warn(`[GLSL.TS]: couldn't init uniform (${i}). Most likely, it was not used in shader and was optimized out.`);continue}let n=m(r);if(!n.valid){console.error(n.message);continue}this.uniforms.set(i,{type:n.type,location:s}),this.setUniformValue(i,n.value)}}setUniformValue(t,i){let r=this.uniforms.get(t);if(!r){console.warn(`[GLSL.TS]: uniform ${t} not found`);return}let s=`${this.uniformPrefix}${t}`,{type:n,location:o}=r;switch(n){case"float":u(i)?this.gl.uniform1f(o,i):console.warn(c(s,"number"));break;case"vec2":E(i)?this.gl.uniform2fv(o,i):console.warn(c(s,"Vec2"));break;case"vec3":U(i)?this.gl.uniform3fv(o,i):console.warn(c(s,"Vec3"));break;case"vec4":b(i)?this.gl.uniform4fv(o,i):console.warn(c(s,"Vec4"));break;case"int":u(i)?this.gl.uniform1i(o,i):console.warn(c(s,"number"));break;case"bool":y(i)?this.gl.uniform1i(o,i?1:0):console.warn(c(s,"boolean"));break;case"image":d(i)?this.loadStaticTexture(s,i):console.warn(c(s,"string"));break;case"video":d(i)?this.loadDynamicTexture(s,i):console.warn(c(s,"string"));break;case"webcam":this.loadDynamicTexture(s);break;default:console.warn(`Unsupported uniform type for ${s}`)}}getTextureUnit(){return this.staticTextures.size+this.dynamicTextures.size}getUniformLocation(t){let i=this.gl.getUniformLocation(this.program,t);if(!i)throw new Error(`Failed to retrieve unform loaction for ${t}`);return i}initializeTexture(t){let i=this.getUniformLocation(t),r=this.gl.createTexture(),s=this.getTextureUnit();return this.gl.uniform1i(i,s),this.gl.activeTexture(this.gl.TEXTURE0+s),this.gl.bindTexture(this.gl.TEXTURE_2D,r),h(this.gl),[r,s]}loadStaticTexture(t,i){let[r,s]=this.initializeTexture(t);this.staticTextures.set(t,{asset:r,unit:s});let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{let o=this.staticTextures.get(t),l=`${t}_size`,a=this.gl.getUniformLocation(this.program,l);if(o){a?(this.uniforms.set(l,{type:"vec2",location:a}),this.gl.uniform2f(a,n.width,n.height)):console.info(`[GLSL.TS]: Could not set "${l}" Uniform. Most likely, it was not used in shader and was optimized out.`),this.gl.activeTexture(this.gl.TEXTURE0+o.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,o.asset),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),p(this.gl,n),h(this.gl,n);let G=this.getUniformLocation(t);this.gl.uniform1i(G,o.unit)}else console.warn(`[GLSL.TS]: no texture found for name: ${t}`)}catch(o){console.error(`[GLSL.TS]: error loading texture ${t}:`,o)}},n.onerror=o=>{console.error(`[GLSL.TS]: error loading texture ${t}:`,o)},n.src=i}async loadDynamicTexture(t,i){let r=document.createElement("video");if(r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.onloadeddata=()=>{let[s,n]=this.initializeTexture(t);this.dynamicTextures.set(t,{video:r,asset:s,unit:n}),r.play();try{let o=this.dynamicTextures.get(t),l=`${t}_size`,a=this.gl.getUniformLocation(this.program,l);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),o&&(a?(this.uniforms.set(l,{type:"vec2",location:a}),this.gl.uniform2f(a,r.videoWidth,r.videoHeight)):console.info(`[GLSL.TS]: Could not set "${l}" Uniform. Most likely, it was not used in shader and was optimized out.`),this.gl.activeTexture(this.gl.TEXTURE0+o.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,o.asset),p(this.gl,o.video),h(this.gl,o.video))}catch(o){console.error(`Error loading texture ${t}:`,o)}},r.onerror=()=>{console.error(`Failed to load texture: ${i}`)},i)r.loop=!0,r.crossOrigin="anonymous",r.src=i;else{let s=await navigator.mediaDevices.getUserMedia({video:!0});r.srcObject=s}}renderDynamicTextures(){for(let t of Array.from(this.dynamicTextures.values()))this.gl.activeTexture(this.gl.TEXTURE0+t.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,t.asset),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t.video)}destroy(){this.staticTextures.forEach(t=>this.gl.deleteTexture(t.asset)),this.staticTextures.clear();for(let t of Array.from(this.dynamicTextures.values())){let i=t.video.srcObject;i instanceof MediaStream?i.getTracks().forEach(r=>r.stop()):t.video.srcObject=null}this.dynamicTextures.clear()}},P=v;var R=`
    attribute vec2 a_position;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }
  `,A=`#version 300 es
    in vec2 a_position;
    
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }`,C=`
    #ifdef GL_ES
    precision mediump float;
    #endif

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `,V=`#version 300 es
    precision mediump float;

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `;var x=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),T=class{constructor(t,i,r){this.container=t,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width=this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.gl=_(this.canvas);let s=i===3?V:C,n=i===3?A:R,o=this.compileShader(this.gl.VERTEX_SHADER,n),l=this.compileShader(this.gl.FRAGMENT_SHADER,r??s);this.program=this.createProgram(o,l),this.gl.useProgram(this.program),this.createBuffer(x);let a=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,0,0)}compileShader(t,i){let r=this.gl.createShader(t);if(!r)throw new Error("Shader creation failed");if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)){let s=`Shader compilation error: ${this.gl.getShaderInfoLog(r)}`;throw this.gl.deleteShader(r),new Error(s)}return r}createProgram(t,i){let r=this.gl.createProgram();if(!r)throw new Error("Error creating WebGL Program");if(this.gl.attachShader(r,t),this.gl.attachShader(r,i),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(`Program linking error: ${this.gl.getProgramInfoLog(r)}`);return r}createBuffer(t){let i=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),i}resizeCanvas(){let t=this.container.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height}destroy(){this.container.innerHTML=""}},I=T;var f=class extends I{constructor({container:i,frag:r,uniforms:s={},uniformPrefix:n="u_",glVersion:o=3}){super(i,o,r);this.mousePos=[0,0];this.controller=new AbortController;this.rafId=null;this.assets=new P(this.gl,this.program,s,n),this.handleResize(),this.addEventListeners()}render(i){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);let r=this.assets.uniforms.get(`${this.assets.uniformPrefix}time`);r&&this.gl.uniform1f(r.location,i*.001);let s=this.assets.uniforms.get(`${this.assets.uniformPrefix}mouse`);s&&this.gl.uniform2f(s.location,this.mousePos[0],this.mousePos[1]),this.assets.renderDynamicTextures(),this.gl.drawArrays(this.gl.TRIANGLES,0,x.length/2),requestAnimationFrame(n=>this.render(n))}handleResize(){super.resizeCanvas();let i=this.assets.uniforms.get(`${this.assets.uniformPrefix}resolution`)??null;if(!i){console.warn(`Could not find resolution uniform (${this.assets.uniformPrefix}resolution) location when resizing canvas`);return}this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.uniform2f(i.location,this.canvas.width,this.canvas.height)}addEventListeners(){let{signal:i}=this.controller;this.canvas.addEventListener("mousemove",r=>{let s=this.canvas.getBoundingClientRect();this.mousePos[0]=r.clientX-s.left,this.mousePos[1]=s.height-(r.clientY-s.top)},{signal:i}),this.canvas.addEventListener("touchmove",r=>{let{clientX:s,clientY:n}=r.touches[0],o=this.canvas.getBoundingClientRect();this.mousePos[0]=s-o.left,this.mousePos[1]=o.height-(n-o.top)},{signal:i}),window.addEventListener("resize",()=>this.handleResize(),{signal:i})}play(){this.rafId=requestAnimationFrame(i=>this.render(i))}pause(){typeof this.rafId=="number"&&(cancelAnimationFrame(this.rafId),this.rafId=null)}updateUniform(i,r){let s=m(r);if(!s.valid){console.warn(s.message);return}this.assets.setUniformValue(i,s.value)}destroy(){super.destroy(),this.assets.destroy(),this.controller.abort()}};
//# sourceMappingURL=index.cjs.map