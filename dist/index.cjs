"use strict";var v=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var N=(e,s)=>{for(var t in s)v(e,t,{get:s[t],enumerable:!0})},O=(e,s,t,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of F(s))!$.call(e,r)&&r!==t&&v(e,r,{get:()=>s[r],enumerable:!(i=z(s,r))||i.enumerable});return e};var W=e=>O(v({},"__esModule",{value:!0}),e);var B={};N(B,{default:()=>g});module.exports=W(B);function u(e){return typeof e=="number"}function T(e){return typeof e=="string"}function E(e){return typeof e=="boolean"}function L(e){return Array.isArray(e)&&e.length===2&&e.every(u)}function S(e){return Array.isArray(e)&&e.length===3&&e.every(u)}function w(e){return Array.isArray(e)&&e.length===4&&e.every(u)}function m(e){if(typeof e!="string")return!1;let s=[".jpg",".jpeg",".png",".avif",".webp"],t=e.toLowerCase();return s.some(i=>t.endsWith(i))}function h(e){if(typeof e!="string")return!1;let s=[".mp4",".webm",".mov"],t=e.toLowerCase();return s.some(i=>t.endsWith(i))}function A(e){let s=e.getContext("webgl2");if(!s)throw new Error("WebGL not supported");return s}function f(e,s){let{TEXTURE_2D:t,RGBA:i,UNSIGNED_BYTE:r}=e,n=new Uint8Array([0,0,0,255]);s?e.texImage2D(e.TEXTURE_2D,0,i,i,r,s):e.texImage2D(t,0,i,1,1,0,i,r,n)}function y(e,s){C(s.width)&&C(s.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR))}function C(e){return e>0&&(e&e-1)===0}function d(e){return typeof e=="string"?m(e)?{valid:!0,type:"image",value:e}:h(e)?{valid:!0,type:"video",value:e}:e==="webcam"?{valid:!0,type:"webcam",value:e}:!isNaN(Number(e))&&e.includes(".")?{valid:!0,type:"float",value:parseFloat(e)}:!isNaN(Number(e))&&!e.includes(".")?{valid:!0,type:"int",value:parseInt(e)}:{valid:!1,message:`Unknown uniform type: ${e}`}:Array.isArray(e)?e.length>=2&&e.length<=4?{valid:!0,type:`vec${e.length}`,value:e}:{valid:!1,message:`Invalid vector length: ${e.length}`}:typeof e=="number"?{valid:!0,type:"float",value:e}:typeof e=="boolean"?{valid:!0,type:"bool",value:e}:{valid:!1,message:`Unknown uniform type: ${e}`}}function c(e,s){return`[GLSL.TS]: Couldn't update ${e}, value must be a ${s}`}function _(e,s,t){if(t==="snake")return`${s}_${e}`;{let i=e.charAt(0).toUpperCase()+e.slice(1);return`${s}${i}`}}var U=class{constructor(s,t,i,r,n){this.uniforms=new Map;this.staticTextures=new Map;this.dynamicTextures=new Map;this.uniformPrefix="u";this.uniformCase="snake";this.loadedAssetCount={images:0,videos:0};this.gl=s,this.program=t,this.uniformPrefix=r,this.uniformCase=n,this.totalAssetCount=Object.values(i).reduce((o,a)=>(m(a)&&o.images++,(h(a)||a==="webcam")&&o.videos++,o),{images:0,videos:0}),this.initializeDefaultUniforms(),this.initializeCustomUniforms(i)}initializeDefaultUniforms(){let s=this.formatUniform("time"),t=this.gl.getUniformLocation(this.program,s);t&&this.uniforms.set(s,{type:"float",location:t});let i=this.formatUniform("resolution"),r=this.gl.getUniformLocation(this.program,i);r&&this.uniforms.set(i,{type:"vec2",location:r});let n=this.formatUniform("mouse"),o=this.gl.getUniformLocation(this.program,n);o&&this.uniforms.set(n,{type:"vec2",location:o})}initializeCustomUniforms(s){for(let[t,i]of Object.entries(s)){let r=this.formatUniform(t),n=this.gl.getUniformLocation(this.program,r);if(!n){console.warn(`[GLSL.TS]: couldn't init uniform (${r}). Most likely, it was not used in shader and was optimized out.`);continue}let o=d(i);if(!o.valid){console.error(o.message);continue}this.uniforms.set(r,{type:o.type,location:n}),this.setUniformValue(t,o.value)}}setUniformValue(s,t){let i=this.formatUniform(s),r=this.uniforms.get(i);if(!r){console.warn(`[GLSL.TS]: uniform ${s} not found`);return}let{type:n,location:o}=r;switch(n){case"float":u(t)?this.gl.uniform1f(o,t):console.warn(c(i,"number"));break;case"vec2":L(t)?this.gl.uniform2fv(o,t):console.warn(c(i,"Vec2"));break;case"vec3":S(t)?this.gl.uniform3fv(o,t):console.warn(c(i,"Vec3"));break;case"vec4":w(t)?this.gl.uniform4fv(o,t):console.warn(c(i,"Vec4"));break;case"int":u(t)?this.gl.uniform1i(o,t):console.warn(c(i,"number"));break;case"bool":E(t)?this.gl.uniform1i(o,t?1:0):console.warn(c(i,"boolean"));break;case"image":T(t)?this.loadStaticTexture(i,t):console.warn(c(i,"string"));break;case"video":T(t)?this.loadDynamicTexture(i,t):console.warn(c(i,"string"));break;case"webcam":this.loadDynamicTexture(i);break;default:console.warn(`Unsupported uniform type for ${i}`)}}formatUniform(s){return _(s,this.uniformPrefix,this.uniformCase)}getTextureUnit(){return this.staticTextures.size+this.dynamicTextures.size}getUniformLocation(s){let t=this.gl.getUniformLocation(this.program,s);if(!t)throw new Error(`Failed to retrieve unform loaction for ${s}`);return t}initializeTexture(s){let t=this.getUniformLocation(s),i=this.gl.createTexture(),r=this.getTextureUnit();return this.gl.uniform1i(t,r),this.gl.activeTexture(this.gl.TEXTURE0+r),this.gl.bindTexture(this.gl.TEXTURE_2D,i),f(this.gl),[i,r]}loadStaticTexture(s,t){let[i,r]=this.initializeTexture(s),n=this.uniformCase==="snake"?`${s}_resolution`:`${s}Resolution`,o=this.gl.getUniformLocation(this.program,n);this.staticTextures.set(s,{asset:i,unit:r}),o&&this.uniforms.set(n,{type:"vec2",location:o});let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{try{let l=this.staticTextures.get(s);if(l){o?(this.uniforms.set(n,{type:"vec2",location:o}),this.gl.uniform2f(o,a.width,a.height)):console.info(`[GLSL.TS]: Could not set "${n}" Uniform. Most likely, it was not used in shader and was optimized out.`),this.gl.activeTexture(this.gl.TEXTURE0+l.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,l.asset),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),y(this.gl,a),f(this.gl,a);let p=this.getUniformLocation(s);this.gl.uniform1i(p,l.unit),this.loadedAssetCount.images++,this.allAssetsLoaded&&this.onLoad?.()}else console.warn(`[GLSL.TS]: no texture found for name: ${s}`)}catch(l){console.error({message:`[GLSL.TS]: error loading image texture ${s}`,src:t,error:l}),this.onError?.({type:"image",src:t})}},a.onerror=l=>{console.error({message:`[GLSL.TS]: error loading image texture ${s}`,src:t,error:l}),this.onError?.({type:"image",src:t})},a.src=t}async loadDynamicTexture(s,t){let i=document.createElement("video");if(i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.onloadeddata=()=>{let[r,n]=this.initializeTexture(s),o=this.uniformCase==="snake"?`${s}_resolution`:`${s}Resolution`,a=this.gl.getUniformLocation(this.program,o);a&&this.uniforms.set(o,{type:"vec2",location:a}),this.dynamicTextures.set(s,{video:i,asset:r,unit:n}),i.play();try{let l=this.dynamicTextures.get(s);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),l&&(a?(this.uniforms.set(o,{type:"vec2",location:a}),this.gl.uniform2f(a,i.videoWidth,i.videoHeight)):console.info(`[GLSL.TS]: Could not set "${o}" Uniform. Most likely, it was not used in shader and was optimized out.`),this.gl.activeTexture(this.gl.TEXTURE0+l.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,l.asset),y(this.gl,l.video),f(this.gl,l.video)),this.loadedAssetCount.videos++,this.allAssetsLoaded&&this.onLoad?.()}catch(l){console.error({message:`[GLSL.TS]: error loading video texture ${s}`,src:t,error:l}),this.onError?.({type:"video",src:t||"webcam"})}},i.onerror=r=>{console.error({message:`[GLSL.TS]: error loading video texture ${s}`,src:t,error:r}),this.onError?.({type:"video",src:t||"webcam"})},t)i.loop=!0,i.crossOrigin="anonymous",i.src=t;else{let r=await navigator.mediaDevices.getUserMedia({video:!0});i.srcObject=r}}renderDynamicTextures(){for(let s of Array.from(this.dynamicTextures.values()))this.gl.activeTexture(this.gl.TEXTURE0+s.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,s.asset),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s.video)}destroy(){this.staticTextures.forEach(s=>this.gl.deleteTexture(s.asset)),this.staticTextures.clear();for(let s of Array.from(this.dynamicTextures.values())){let t=s.video.srcObject;t instanceof MediaStream?t.getTracks().forEach(i=>i.stop()):s.video.srcObject=null}this.dynamicTextures.clear(),this.onLoad=void 0,this.onError=void 0}get allAssetsLoaded(){return this.totalAssetCount.images===this.loadedAssetCount.images&&this.totalAssetCount.videos===this.loadedAssetCount.videos}},R=U;var P=`
    attribute vec2 a_position;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }
  `,V=`#version 300 es
    in vec2 a_position;
    
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }`,I=`
    #ifdef GL_ES
    precision mediump float;
    #endif

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `,D=`#version 300 es
    precision mediump float;

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    out vec4 outColor;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      outColor = vec4(color, 1.0);
    }
  `;var x=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),b=class{constructor(s,t,i){this.container=s,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width=this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.gl=A(this.canvas),this.gl.clearColor(0,0,0,1),"drawingBufferColorSpace"in this.gl&&(this.gl.drawingBufferColorSpace="display-p3"),"unpackColorSpace"in this.gl&&(this.gl.unpackColorSpace="display-p3");let r=t===3?D:I,n=t===3?V:P,o=this.compileShader(n,"vert"),a=this.compileShader(i??r,"frag");this.program=this.createProgram(o,a),this.gl.useProgram(this.program),this.createBuffer(x);let l=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(l),this.gl.vertexAttribPointer(l,2,this.gl.FLOAT,!1,0,0)}compileShader(s,t){let i=this.gl.createShader(t==="frag"?this.gl.FRAGMENT_SHADER:this.gl.VERTEX_SHADER);if(!i)throw new Error("Shader creation failed");if(this.gl.shaderSource(i,s),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){let r=`Shader compilation error: ${this.gl.getShaderInfoLog(i)}`;throw this.gl.deleteShader(i),new Error(r)}return i}createProgram(s,t){let i=this.gl.createProgram();if(this.gl.attachShader(i,s),this.gl.attachShader(i,t),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error(`Program linking error: ${this.gl.getProgramInfoLog(i)}`);return i}createBuffer(s){let t=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),t}resizeCanvas(){let s=this.container.getBoundingClientRect();this.canvas.width=s.width,this.canvas.height=s.height}destroy(){this.container.innerHTML=""}},G=b;var g=class extends G{constructor({container:t,frag:i,uniforms:r={},uniformPrefix:n="u",uniformCase:o="snake",glVersion:a=3}){super(t,a,i);this.mousePos=[0,0];this.controller=new AbortController;this.resizeObserver=null;this.rafId=null;this.startTime=null;this.pauseStartTime=null;this.lastRenderTime=0;this.totalPausedTime=0;this.assets=new R(this.gl,this.program,r,n,o),this.handleResize(),this.addEventListeners()}render(t,i=!0){if(this.startTime===null)return;this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.lastRenderTime=t;let r=this.assets.uniforms.get(this.assets.formatUniform("time"));if(r){let a=t-this.totalPausedTime-this.startTime;this.gl.uniform1f(r.location,a*.001)}let n=this.assets.uniforms.get(this.assets.formatUniform("mouse"));n&&this.gl.uniform2f(n.location,this.mousePos[0],this.mousePos[1]),this.assets.renderDynamicTextures(),this.gl.drawArrays(this.gl.TRIANGLES,0,x.length/2),i&&(this.rafId=requestAnimationFrame(o=>this.render(o)))}handleResize(){super.resizeCanvas();let t=this.assets.formatUniform("resolution"),i=this.assets.uniforms.get(t)??null;if(!i){console.warn(`Could not find resolution uniform (${t}) location when resizing canvas`);return}this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.uniform2f(i.location,this.canvas.width,this.canvas.height),this.render(this.lastRenderTime,!1)}addEventListeners(){let{signal:t}=this.controller;this.canvas.addEventListener("mousemove",i=>{let r=this.canvas.getBoundingClientRect();this.mousePos[0]=i.clientX-r.left,this.mousePos[1]=r.height-(i.clientY-r.top)},{signal:t}),this.canvas.addEventListener("touchmove",i=>{let{clientX:r,clientY:n}=i.touches[0],o=this.canvas.getBoundingClientRect();this.mousePos[0]=r-o.left,this.mousePos[1]=o.height-(n-o.top)},{signal:t}),this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.container)}play(t=!0){this.paused&&(this.pauseStartTime!==null?(this.totalPausedTime+=performance.now()-this.pauseStartTime,this.pauseStartTime=null):this.totalPausedTime=performance.now(),this.startTime===null&&(this.startTime=performance.now()),this.assets.dynamicTextures.size>0&&this.assets.dynamicTextures.forEach(i=>{i.video.play()}),t?this.rafId=requestAnimationFrame(i=>this.render(i,t)):this.render(performance.now(),t))}pause(){typeof this.rafId!="number"||this.paused||(this.pauseStartTime=performance.now(),cancelAnimationFrame(this.rafId),this.rafId=null,this.assets.dynamicTextures.size>0&&this.assets.dynamicTextures.forEach(t=>{t.video.pause()}))}updateUniform(t,i){let r=d(i);if(!r.valid){console.warn(r.message);return}this.assets.setUniformValue(t,r.value)}destroy(){super.destroy(),this.assets.destroy(),this.controller.abort(),this.resizeObserver?.unobserve(this.container),this.resizeObserver?.disconnect()}get paused(){return this.rafId===null}get uniforms(){let t=Object.fromEntries(this.assets.uniforms),r=Object.entries(t).map(([n,{location:o,type:a}])=>{switch(a){case"vec2":case"vec3":case"vec4":let l=this.gl.getUniform(this.program,o);return[n,Array.from(l)];case"image":let p=this.assets.staticTextures.get(n);return[n,p?.asset];case"video":case"webcam":let k=this.assets.dynamicTextures.get(n);return[n,k?.asset];default:let M=this.gl.getUniform(this.program,o);return[n,M]}});return Object.fromEntries(r)}set onLoad(t){this.assets.allAssetsLoaded?t():this.assets.onLoad=t}};
//# sourceMappingURL=index.cjs.map