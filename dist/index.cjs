"use strict";var m=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var D=(e,r)=>{for(var t in r)m(e,t,{get:r[t],enumerable:!0})},M=(e,r,t,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of $(r))!I.call(e,s)&&s!==t&&m(e,s,{get:()=>r[s],enumerable:!(i=C(r,s))||i.enumerable});return e};var V=e=>M(m({},"__esModule",{value:!0}),e);var G={};D(G,{default:()=>h});module.exports=V(G);function l(e){return typeof e=="number"}function f(e){return typeof e=="string"}function v(e){return typeof e=="boolean"}function y(e){return Array.isArray(e)&&e.length===2&&e.every(l)}function x(e){return Array.isArray(e)&&e.length===3&&e.every(l)}function E(e){return Array.isArray(e)&&e.length===4&&e.every(l)}function b(e){let r=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".tiff",".ico"],t=e.toLowerCase();return r.some(i=>t.endsWith(i))}function U(e){let r=[".mp4",".avi",".mov",".mkv",".wmv",".flv",".webm",".ts"],t=e.toLowerCase();return r.some(i=>t.endsWith(i))}function L(e){let r=e.getContext("webgl");if(!r)throw new Error("WebGL not supported");return r}function u(e,r){let{TEXTURE_2D:t,RGBA:i,UNSIGNED_BYTE:s}=e,o=new Uint8Array([0,0,0,255]);r?e.texImage2D(e.TEXTURE_2D,0,i,i,s,r):e.texImage2D(t,0,i,1,1,0,i,s,o)}function g(e,r){w(r.width)&&w(r.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR))}function w(e){return e>0&&(e&e-1)===0}function R(e){return typeof e=="string"?b(e)?{valid:!0,type:"image"}:U(e)?{valid:!0,type:"video"}:e==="webcam"?{valid:!0,type:"webcam"}:!isNaN(Number(e))&&e.includes(".")?{valid:!0,type:"float"}:!isNaN(Number(e))&&!e.includes(".")?{valid:!0,type:"int"}:{valid:!1,message:`Unknown uniform type: ${e}`}:Array.isArray(e)?e.length>=2&&e.length<=4?{valid:!0,type:`vec${e.length}`}:{valid:!1,message:`Invalid vector length: ${e.length}`}:typeof e=="number"?{valid:!0,type:"float"}:typeof e=="boolean"?{valid:!0,type:"bool"}:{valid:!1,message:`Unknown uniform type: ${e}`}}var d=class{constructor(r,t,i,s){this.uniforms=new Map;this.staticTextures=new Map;this.dynamicTextures=new Map;this.uniformPrefix="u_";this.gl=r,this.program=t,this.uniformPrefix=s,this.initializeDefaultUniforms(),this.initializeCustomUniforms(i)}initializeDefaultUniforms(){let r=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}time`);r&&this.uniforms.set(`${this.uniformPrefix}time`,{type:"float",location:r});let t=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}resolution`);t&&this.uniforms.set(`${this.uniformPrefix}resolution`,{type:"vec2",location:t});let i=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}mouse`);i&&this.uniforms.set(`${this.uniformPrefix}mouse`,{type:"vec2",location:i})}initializeCustomUniforms(r){for(let[t,i]of Object.entries(r)){let s=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}${t}`);if(!s){console.warn(`Couldn't init uniform (${t}). Did you set it?`);continue}let o=R(i);if(!o.valid){console.error(o.message);continue}this.uniforms.set(t,{type:o.type,location:s}),this.setUniformValue(t,i)}}setUniformValue(r,t){let i=this.uniforms.get(r);if(!i){console.warn(`Uniform ${r} not found`);return}let s=`${this.uniformPrefix}${r}`,{type:o,location:n}=i;switch(o){case"float":l(t)?this.gl.uniform1f(n,t):console.warn(`Couldn't update ${s}, value must be a number`);break;case"vec2":y(t)?this.gl.uniform2fv(n,t):console.warn(`Couldn't update ${s}, value must be a Vec2`);break;case"vec3":x(t)?this.gl.uniform3fv(n,t):console.warn(`Couldn't update ${s}, value must be a Vec3`);break;case"vec4":E(t)?this.gl.uniform4fv(n,t):console.warn(`Couldn't update ${s}, value must be a Vec4`);break;case"int":l(t)?this.gl.uniform1i(n,t):console.warn(`Couldn't update ${s}, value must be a number`);break;case"bool":v(t)?this.gl.uniform1i(n,t?1:0):console.warn(`Couldn't update ${s}, value must be a boolean`);break;case"image":f(t)?this.loadStaticTexture(s,t):console.warn(`Couldn't update ${s}, value must be a string`);break;case"video":f(t)?this.loadDynamicTexture(s,t):console.warn(`Couldn't update ${s}, value must be a string`);break;case"webcam":this.loadDynamicTexture(s);break;default:console.warn(`Unsupported uniform type for ${s}`)}}getTextureUnit(){return this.staticTextures.size+this.dynamicTextures.size}getUniformLocation(r){let t=this.gl.getUniformLocation(this.program,r);if(!t)throw new Error(`Failed to retrieve unform loaction for ${r}`);return t}initializeTexture(r){let t=this.getUniformLocation(r),i=this.gl.createTexture(),s=this.getTextureUnit();return this.gl.uniform1i(t,s),this.gl.activeTexture(this.gl.TEXTURE0+s),this.gl.bindTexture(this.gl.TEXTURE_2D,i),u(this.gl),[i,s]}loadStaticTexture(r,t){let[i,s]=this.initializeTexture(r);this.staticTextures.set(r,{asset:i,unit:s});let o=new Image;o.crossOrigin="anonymous",o.onload=()=>{try{let n=this.staticTextures.get(r),c=`${r}_size`,a=this.gl.getUniformLocation(this.program,c);a&&n&&(this.uniforms.set(c,{type:"vec2",location:a}),this.gl.uniform2f(a,o.width,o.height),this.gl.activeTexture(this.gl.TEXTURE0+n.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,n.asset),g(this.gl,o),u(this.gl,o))}catch(n){console.error(`Error loading texture ${r}:`,n)}},o.onerror=()=>{console.error(`Failed to load texture: ${t}`)},o.src=t}async loadDynamicTexture(r,t){let i=document.createElement("video");if(i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.onloadeddata=()=>{let[s,o]=this.initializeTexture(r);this.dynamicTextures.set(r,{video:i,asset:s,unit:o}),i.play();try{let n=this.dynamicTextures.get(r),c=`${r}_size`,a=this.gl.getUniformLocation(this.program,c);a&&n&&(this.uniforms.set(c,{type:"vec2",location:a}),this.gl.uniform2f(a,i.videoWidth,i.videoHeight),this.gl.activeTexture(this.gl.TEXTURE0+n.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,n.asset),g(this.gl,n.video),u(this.gl,n.video))}catch(n){console.error(`Error loading texture ${r}:`,n)}},i.onerror=()=>{console.error(`Failed to load texture: ${t}`)},t)i.loop=!0,i.crossOrigin="anonymous",i.src=t;else{let s=await navigator.mediaDevices.getUserMedia({video:!0});i.srcObject=s}}renderDynamicTextures(){for(let r of Array.from(this.dynamicTextures.values()))this.gl.activeTexture(this.gl.TEXTURE0+r.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,r.asset),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r.video)}destroy(){this.staticTextures.forEach(r=>this.gl.deleteTexture(r.asset)),this.staticTextures.clear();for(let r of Array.from(this.dynamicTextures.values())){let t=r.video.srcObject;t instanceof MediaStream?t.getTracks().forEach(i=>i.stop()):r.video.srcObject=null}this.dynamicTextures.clear()}},P=d;var _=`
    attribute vec2 a_position;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }
  `,S=`
    #ifdef GL_ES
    precision mediump float;
    #endif

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `;var T=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),p=class{constructor(r,t){this.container=r,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width=this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.gl=L(this.canvas);let i=this.compileShader(this.gl.VERTEX_SHADER,_),s=this.compileShader(this.gl.FRAGMENT_SHADER,t??S);this.program=this.createProgram(i,s),this.gl.useProgram(this.program),this.createBuffer(T);let o=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,2,this.gl.FLOAT,!1,0,0)}compileShader(r,t){let i=this.gl.createShader(r);if(!i)throw new Error("Shader creation failed");if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw this.gl.deleteShader(i),new Error(`Shader compilation error: ${this.gl.getShaderInfoLog(i)}`);return i}createProgram(r,t){let i=this.gl.createProgram();if(!i)throw new Error("Error creating WebGL Program");if(this.gl.attachShader(i,r),this.gl.attachShader(i,t),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw new Error(`Program linking error: ${this.gl.getProgramInfoLog(i)}`);return i}createBuffer(r){let t=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.STATIC_DRAW),t}resizeCanvas(){let r=this.container.getBoundingClientRect();this.canvas.width=r.width,this.canvas.height=r.height}destroy(){this.container.innerHTML=""}},A=p;var h=class extends A{constructor({container:t,frag:i,uniforms:s={},uniformPrefix:o="u_"}){super(t,i);this.mousePos=[0,0];this.controller=new AbortController;this.rafId=null;this.assets=new P(this.gl,this.program,s,o),this.handleResize(),this.addEventListeners()}render(t){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);let i=this.assets.uniforms.get(`${this.assets.uniformPrefix}time`);i&&this.gl.uniform1f(i.location,t*.001);let s=this.assets.uniforms.get(`${this.assets.uniformPrefix}mouse`);s&&this.gl.uniform2f(s.location,this.mousePos[0],this.mousePos[1]),this.assets.renderDynamicTextures(),this.gl.drawArrays(this.gl.TRIANGLES,0,T.length/2),requestAnimationFrame(o=>this.render(o))}handleResize(){super.resizeCanvas();let t=this.assets.uniforms.get(`${this.assets.uniformPrefix}resolution`)??null;if(!t){console.warn(`Could not find resolution uniform (${this.assets.uniformPrefix}resolution) location when resizing canvas`);return}this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.uniform2f(t.location,this.canvas.width,this.canvas.height)}addEventListeners(){let{signal:t}=this.controller;this.canvas.addEventListener("mousemove",i=>{let s=this.canvas.getBoundingClientRect();this.mousePos[0]=i.clientX-s.left,this.mousePos[1]=s.height-(i.clientY-s.top)},{signal:t}),this.canvas.addEventListener("touchmove",i=>{let{clientX:s,clientY:o}=i.touches[0],n=this.canvas.getBoundingClientRect();this.mousePos[0]=s-n.left,this.mousePos[1]=n.height-(o-n.top)},{signal:t}),window.addEventListener("resize",()=>this.handleResize(),{signal:t})}play(){this.rafId=requestAnimationFrame(t=>this.render(t))}pause(){typeof this.rafId=="number"&&(cancelAnimationFrame(this.rafId),this.rafId=null)}updateUniform(t,i){this.assets.setUniformValue(t,i)}destroy(){super.destroy(),this.assets.destroy(),this.controller.abort()}};
//# sourceMappingURL=index.cjs.map