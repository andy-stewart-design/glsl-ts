function l(i){return typeof i=="number"}function h(i){return typeof i=="string"}function T(i){return typeof i=="boolean"}function v(i){return Array.isArray(i)&&i.length===2&&i.every(l)}function y(i){return Array.isArray(i)&&i.length===3&&i.every(l)}function b(i){return Array.isArray(i)&&i.length===4&&i.every(l)}function E(i){let e=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".tiff",".ico"],t=i.toLowerCase();return e.some(r=>t.endsWith(r))}function x(i){let e=[".mp4",".avi",".mov",".mkv",".wmv",".flv",".webm",".ts"],t=i.toLowerCase();return e.some(r=>t.endsWith(r))}function w(i){let e=i.getContext("webgl");if(!e)throw new Error("WebGL not supported");return e}function u(i,e){let{TEXTURE_2D:t,RGBA:r,UNSIGNED_BYTE:s}=i,o=new Uint8Array([0,0,0,255]);e?i.texImage2D(i.TEXTURE_2D,0,r,r,s,e):i.texImage2D(t,0,r,1,1,0,r,s,o);}function m(i,e){U(e.width)&&U(e.height)?i.generateMipmap(i.TEXTURE_2D):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR));}function U(i){return i>0&&(i&i-1)===0}function _(i){return typeof i=="string"?E(i)?{valid:true,type:"image"}:x(i)?{valid:true,type:"video"}:i==="webcam"?{valid:true,type:"webcam"}:!isNaN(Number(i))&&i.includes(".")?{valid:true,type:"float"}:!isNaN(Number(i))&&!i.includes(".")?{valid:true,type:"int"}:{valid:false,message:`Unknown uniform type: ${i}`}:Array.isArray(i)?i.length>=2&&i.length<=4?{valid:true,type:`vec${i.length}`}:{valid:false,message:`Invalid vector length: ${i.length}`}:typeof i=="number"?{valid:true,type:"float"}:typeof i=="boolean"?{valid:true,type:"bool"}:{valid:false,message:`Unknown uniform type: ${i}`}}var g=class{constructor(e,t,r={}){this.uniforms=new Map;this.staticTextures=new Map;this.dynamicTextures=new Map;this.gl=e,this.program=t,this.initializeDefaultUniforms(),this.initializeCustomUniforms(r);}initializeDefaultUniforms(){let e=this.gl.getUniformLocation(this.program,"u_time");e&&this.uniforms.set("u_time",{type:"float",location:e});let t=this.gl.getUniformLocation(this.program,"u_resolution");t&&this.uniforms.set("u_resolution",{type:"vec2",location:t});let r=this.gl.getUniformLocation(this.program,"u_mouse");r&&this.uniforms.set("u_mouse",{type:"vec2",location:r});}initializeCustomUniforms(e){for(let[t,r]of Object.entries(e)){let s=this.gl.getUniformLocation(this.program,t);if(!s)continue;let o=_(r);if(!o.valid){console.error(o.message);continue}this.uniforms.set(t,{type:o.type,location:s}),this.setUniformValue(t,r);}}setUniformValue(e,t){let r=this.uniforms.get(e);if(!r){console.warn(`Uniform ${e} not found`);return}let{type:s,location:o}=r;switch(s){case "float":l(t)?this.gl.uniform1f(o,t):console.warn(`Couldn't update ${e}, value must be a number`);break;case "vec2":v(t)?this.gl.uniform2fv(o,t):console.warn(`Couldn't update ${e}, value must be a Vec2`);break;case "vec3":y(t)?this.gl.uniform3fv(o,t):console.warn(`Couldn't update ${e}, value must be a Vec3`);break;case "vec4":b(t)?this.gl.uniform4fv(o,t):console.warn(`Couldn't update ${e}, value must be a Vec4`);break;case "int":l(t)?this.gl.uniform1i(o,t):console.warn(`Couldn't update ${e}, value must be a number`);break;case "bool":T(t)?this.gl.uniform1i(o,t?1:0):console.warn(`Couldn't update ${e}, value must be a boolean`);break;case "image":h(t)?this.loadStaticTexture(e,t):console.warn(`Couldn't update ${e}, value must be a string`);break;case "video":h(t)?this.loadDynamicTexture(e,t):console.warn(`Couldn't update ${e}, value must be a string`);break;case "webcam":this.loadDynamicTexture(e);break;default:console.warn(`Unsupported uniform type for ${e}`);}}getTextureUnit(){return this.staticTextures.size+this.dynamicTextures.size}getUniformLocation(e){let t=this.gl.getUniformLocation(this.program,e);if(!t)throw new Error(`Failed to retrieve unform loaction for ${e}`);return t}initializeTexture(e){let t=this.getUniformLocation(e),r=this.gl.createTexture(),s=this.getTextureUnit();return this.gl.uniform1i(t,s),this.gl.activeTexture(this.gl.TEXTURE0+s),this.gl.bindTexture(this.gl.TEXTURE_2D,r),u(this.gl),[r,s]}loadStaticTexture(e,t){let[r,s]=this.initializeTexture(e);this.staticTextures.set(e,{asset:r,unit:s});let o=new Image;o.crossOrigin="anonymous",o.onload=()=>{try{let n=this.staticTextures.get(e),c=`${e}_size`,a=this.gl.getUniformLocation(this.program,c);a&&n&&(this.uniforms.set(c,{type:"vec2",location:a}),this.gl.uniform2f(a,o.width,o.height),this.gl.activeTexture(this.gl.TEXTURE0+n.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,n.asset),m(this.gl,o),u(this.gl,o));}catch(n){console.error(`Error loading texture ${e}:`,n);}},o.onerror=()=>{console.error(`Failed to load texture: ${t}`);},o.src=t;}async loadDynamicTexture(e,t){let r=document.createElement("video");if(r.muted=true,r.onloadeddata=()=>{let[s,o]=this.initializeTexture(e);this.dynamicTextures.set(e,{video:r,asset:s,unit:o}),r.play();try{let n=this.dynamicTextures.get(e),c=`${e}_size`,a=this.gl.getUniformLocation(this.program,c);a&&n&&(this.uniforms.set(c,{type:"vec2",location:a}),this.gl.uniform2f(a,r.videoWidth,r.videoHeight),this.gl.activeTexture(this.gl.TEXTURE0+n.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,n.asset),m(this.gl,n.video),u(this.gl,n.video));}catch(n){console.error(`Error loading texture ${e}:`,n);}},r.onerror=()=>{console.error(`Failed to load texture: ${t}`);},t)r.loop=true,r.crossOrigin="anonymous",r.src=t;else {let s=await navigator.mediaDevices.getUserMedia({video:true});r.autoplay=true,r.srcObject=s;}}renderDynamicTextures(){for(let e of Array.from(this.dynamicTextures.values()))this.gl.activeTexture(this.gl.TEXTURE0+e.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,e.asset),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e.video);}destroy(){this.staticTextures.forEach(e=>this.gl.deleteTexture(e.asset)),this.staticTextures.clear();for(let e of Array.from(this.dynamicTextures.values())){let t=e.video.srcObject;t instanceof MediaStream?t.getTracks().forEach(r=>r.stop()):e.video.srcObject=null;}this.dynamicTextures.clear();}},L=g;var R=`
    attribute vec2 a_position;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }
  `,C=`
    #ifdef GL_ES
    precision mediump float;
    #endif

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `;var d=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),f=class{constructor(e,t){this.container=e,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width=this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.gl=w(this.canvas);let r=this.compileShader(this.gl.VERTEX_SHADER,R),s=this.compileShader(this.gl.FRAGMENT_SHADER,t??C);this.program=this.createProgram(r,s),this.gl.useProgram(this.program),this.createBuffer(d);let o=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,2,this.gl.FLOAT,false,0,0);}compileShader(e,t){let r=this.gl.createShader(e);if(!r)throw new Error("Shader creation failed");if(this.gl.shaderSource(r,t),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS))throw this.gl.deleteShader(r),new Error(`Shader compilation error: ${this.gl.getShaderInfoLog(r)}`);return r}createProgram(e,t){let r=this.gl.createProgram();if(!r)throw new Error("Error creating WebGL Program");if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(`Program linking error: ${this.gl.getProgramInfoLog(r)}`);return r}createBuffer(e){let t=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),t}resizeCanvas(){let e=this.container.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height;}destroy(){this.container.innerHTML="";}},S=f;var p=class extends S{constructor(t,r,s={}){super(t,r);this.mousePos=[0,0];this.controller=new AbortController;this.rafId=null;this.assets=new L(this.gl,this.program,s),this.handleResize(),this.addEventListeners();}render(t){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);let r=this.assets.uniforms.get("u_time");r&&this.gl.uniform1f(r.location,t*.001);let s=this.assets.uniforms.get("u_mouse");s&&this.gl.uniform2f(s.location,this.mousePos[0],this.mousePos[1]),this.assets.renderDynamicTextures(),this.gl.drawArrays(this.gl.TRIANGLES,0,d.length/2),requestAnimationFrame(o=>this.render(o));}handleResize(){super.resizeCanvas();let t=this.assets.uniforms.get("u_resolution")??null;if(!t){console.warn("Could not find resolution uniform (u_resolution) location when resizing canvas");return}this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.uniform2f(t.location,this.canvas.width,this.canvas.height);}addEventListeners(){let{signal:t}=this.controller;this.canvas.addEventListener("mousemove",r=>{let s=this.canvas.getBoundingClientRect();this.mousePos[0]=r.clientX-s.left,this.mousePos[1]=s.height-(r.clientY-s.top);},{signal:t}),window.addEventListener("resize",()=>this.handleResize(),{signal:t});}play(){this.rafId=requestAnimationFrame(t=>this.render(t));}pause(){typeof this.rafId=="number"&&(cancelAnimationFrame(this.rafId),this.rafId=null);}updateUniform(t,r){this.assets.setUniformValue(t,r);}destroy(){super.destroy(),this.assets.destroy(),this.controller.abort();}};export{p as default};//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map