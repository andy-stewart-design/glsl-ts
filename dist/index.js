function c(i){return typeof i=="number"}function m(i){return typeof i=="string"}function v(i){return typeof i=="boolean"}function T(i){return Array.isArray(i)&&i.length===2&&i.every(c)}function y(i){return Array.isArray(i)&&i.length===3&&i.every(c)}function x(i){return Array.isArray(i)&&i.length===4&&i.every(c)}function E(i){let r=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".tiff",".ico"],e=i.toLowerCase();return r.some(t=>e.endsWith(t))}function b(i){let r=[".mp4",".avi",".mov",".mkv",".wmv",".flv",".webm",".ts"],e=i.toLowerCase();return r.some(t=>e.endsWith(t))}function w(i){let r=i.getContext("webgl2");if(!r)throw new Error("WebGL not supported");return r}function u(i,r){let{TEXTURE_2D:e,RGBA:t,UNSIGNED_BYTE:s}=i,n=new Uint8Array([0,0,0,255]);r?i.texImage2D(i.TEXTURE_2D,0,t,t,s,r):i.texImage2D(e,0,t,1,1,0,t,s,n)}function h(i,r){U(r.width)&&U(r.height)?i.generateMipmap(i.TEXTURE_2D):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR))}function U(i){return i>0&&(i&i-1)===0}function _(i){return typeof i=="string"?E(i)?{valid:!0,type:"image"}:b(i)?{valid:!0,type:"video"}:i==="webcam"?{valid:!0,type:"webcam"}:!isNaN(Number(i))&&i.includes(".")?{valid:!0,type:"float"}:!isNaN(Number(i))&&!i.includes(".")?{valid:!0,type:"int"}:{valid:!1,message:`Unknown uniform type: ${i}`}:Array.isArray(i)?i.length>=2&&i.length<=4?{valid:!0,type:`vec${i.length}`}:{valid:!1,message:`Invalid vector length: ${i.length}`}:typeof i=="number"?{valid:!0,type:"float"}:typeof i=="boolean"?{valid:!0,type:"bool"}:{valid:!1,message:`Unknown uniform type: ${i}`}}var f=class{constructor(r,e,t,s){this.uniforms=new Map;this.staticTextures=new Map;this.dynamicTextures=new Map;this.uniformPrefix="u_";this.gl=r,this.program=e,this.uniformPrefix=s,this.initializeDefaultUniforms(),this.initializeCustomUniforms(t)}initializeDefaultUniforms(){let r=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}time`);r&&this.uniforms.set(`${this.uniformPrefix}time`,{type:"float",location:r});let e=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}resolution`);e&&this.uniforms.set(`${this.uniformPrefix}resolution`,{type:"vec2",location:e});let t=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}mouse`);t&&this.uniforms.set(`${this.uniformPrefix}mouse`,{type:"vec2",location:t})}initializeCustomUniforms(r){for(let[e,t]of Object.entries(r)){let s=this.gl.getUniformLocation(this.program,`${this.uniformPrefix}${e}`);if(!s){console.warn(`Couldn't init uniform (${e}). Did you set it?`);continue}let n=_(t);if(!n.valid){console.error(n.message);continue}this.uniforms.set(e,{type:n.type,location:s}),this.setUniformValue(e,t)}}setUniformValue(r,e){let t=this.uniforms.get(r);if(!t){console.warn(`Uniform ${r} not found`);return}let s=`${this.uniformPrefix}${r}`,{type:n,location:o}=t;switch(n){case"float":c(e)?this.gl.uniform1f(o,e):console.warn(`Couldn't update ${s}, value must be a number`);break;case"vec2":T(e)?this.gl.uniform2fv(o,e):console.warn(`Couldn't update ${s}, value must be a Vec2`);break;case"vec3":y(e)?this.gl.uniform3fv(o,e):console.warn(`Couldn't update ${s}, value must be a Vec3`);break;case"vec4":x(e)?this.gl.uniform4fv(o,e):console.warn(`Couldn't update ${s}, value must be a Vec4`);break;case"int":c(e)?this.gl.uniform1i(o,e):console.warn(`Couldn't update ${s}, value must be a number`);break;case"bool":v(e)?this.gl.uniform1i(o,e?1:0):console.warn(`Couldn't update ${s}, value must be a boolean`);break;case"image":m(e)?this.loadStaticTexture(s,e):console.warn(`Couldn't update ${s}, value must be a string`);break;case"video":m(e)?this.loadDynamicTexture(s,e):console.warn(`Couldn't update ${s}, value must be a string`);break;case"webcam":this.loadDynamicTexture(s);break;default:console.warn(`Unsupported uniform type for ${s}`)}}getTextureUnit(){return this.staticTextures.size+this.dynamicTextures.size}getUniformLocation(r){let e=this.gl.getUniformLocation(this.program,r);if(!e)throw new Error(`Failed to retrieve unform loaction for ${r}`);return e}initializeTexture(r){let e=this.getUniformLocation(r),t=this.gl.createTexture(),s=this.getTextureUnit();return this.gl.uniform1i(e,s),this.gl.activeTexture(this.gl.TEXTURE0+s),this.gl.bindTexture(this.gl.TEXTURE_2D,t),u(this.gl),[t,s]}loadStaticTexture(r,e){let[t,s]=this.initializeTexture(r);this.staticTextures.set(r,{asset:t,unit:s});let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{let o=this.staticTextures.get(r),l=`${r}_size`,a=this.gl.getUniformLocation(this.program,l);a&&o&&(this.uniforms.set(l,{type:"vec2",location:a}),this.gl.uniform2f(a,n.width,n.height),this.gl.activeTexture(this.gl.TEXTURE0+o.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,o.asset),h(this.gl,n),u(this.gl,n))}catch(o){console.error(`Error loading texture ${r}:`,o)}},n.onerror=()=>{console.error(`Failed to load texture: ${e}`)},n.src=e}async loadDynamicTexture(r,e){let t=document.createElement("video");if(t.muted=!0,t.autoplay=!0,t.playsInline=!0,t.onloadeddata=()=>{let[s,n]=this.initializeTexture(r);this.dynamicTextures.set(r,{video:t,asset:s,unit:n}),t.play();try{let o=this.dynamicTextures.get(r),l=`${r}_size`,a=this.gl.getUniformLocation(this.program,l);a&&o&&(this.uniforms.set(l,{type:"vec2",location:a}),this.gl.uniform2f(a,t.videoWidth,t.videoHeight),this.gl.activeTexture(this.gl.TEXTURE0+o.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,o.asset),h(this.gl,o.video),u(this.gl,o.video))}catch(o){console.error(`Error loading texture ${r}:`,o)}},t.onerror=()=>{console.error(`Failed to load texture: ${e}`)},e)t.loop=!0,t.crossOrigin="anonymous",t.src=e;else{let s=await navigator.mediaDevices.getUserMedia({video:!0});t.srcObject=s}}renderDynamicTextures(){for(let r of Array.from(this.dynamicTextures.values()))this.gl.activeTexture(this.gl.TEXTURE0+r.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,r.asset),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r.video)}destroy(){this.staticTextures.forEach(r=>this.gl.deleteTexture(r.asset)),this.staticTextures.clear();for(let r of Array.from(this.dynamicTextures.values())){let e=r.video.srcObject;e instanceof MediaStream?e.getTracks().forEach(t=>t.stop()):r.video.srcObject=null}this.dynamicTextures.clear()}},L=f;var S=`
    attribute vec2 a_position;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }
  `,R=`#version 300 es
    in vec2 a_position;
    
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
    }`,P=`
    #ifdef GL_ES
    precision mediump float;
    #endif

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `,C=`#version 300 es
    precision mediump float;

    uniform float u_time;
    uniform vec2 u_resolution;
    uniform vec2 u_mouse;

    void main() {
      vec2 st = gl_FragCoord.xy / u_resolution;
      vec2 mouse = u_mouse / u_resolution;

      // Distance from the mouse
      float dist = distance(st, mouse);
      
      // Color based on time and distance
      vec3 color = vec3(0.5 + 0.5 * cos(u_time + dist * 10.0), dist, st.x);
      gl_FragColor = vec4(color, 1.0);
    }
  `;var d=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),g=class{constructor(r,e,t){this.container=r,this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width=this.canvas.style.height="100%",this.container.appendChild(this.canvas),this.gl=w(this.canvas);let s=e===3?C:P,n=e===3?R:S,o=this.compileShader(this.gl.VERTEX_SHADER,n),l=this.compileShader(this.gl.FRAGMENT_SHADER,t??s);this.program=this.createProgram(o,l),this.gl.useProgram(this.program),this.createBuffer(d);let a=this.gl.getAttribLocation(this.program,"a_position");this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,0,0)}compileShader(r,e){let t=this.gl.createShader(r);if(!t)throw new Error("Shader creation failed");if(this.gl.shaderSource(t,e),this.gl.compileShader(t),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)){let s=`Shader compilation error: ${this.gl.getShaderInfoLog(t)}`;throw this.gl.deleteShader(t),new Error(s)}return t}createProgram(r,e){let t=this.gl.createProgram();if(!t)throw new Error("Error creating WebGL Program");if(this.gl.attachShader(t,r),this.gl.attachShader(t,e),this.gl.linkProgram(t),!this.gl.getProgramParameter(t,this.gl.LINK_STATUS))throw new Error(`Program linking error: ${this.gl.getProgramInfoLog(t)}`);return t}createBuffer(r){let e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.STATIC_DRAW),e}resizeCanvas(){let r=this.container.getBoundingClientRect();this.canvas.width=r.width,this.canvas.height=r.height}destroy(){this.container.innerHTML=""}},A=g;var p=class extends A{constructor({container:e,frag:t,uniforms:s={},uniformPrefix:n="u_",glVersion:o=3}){super(e,o,t);this.mousePos=[0,0];this.controller=new AbortController;this.rafId=null;this.assets=new L(this.gl,this.program,s,n),this.handleResize(),this.addEventListeners()}render(e){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);let t=this.assets.uniforms.get(`${this.assets.uniformPrefix}time`);t&&this.gl.uniform1f(t.location,e*.001);let s=this.assets.uniforms.get(`${this.assets.uniformPrefix}mouse`);s&&this.gl.uniform2f(s.location,this.mousePos[0],this.mousePos[1]),this.assets.renderDynamicTextures(),this.gl.drawArrays(this.gl.TRIANGLES,0,d.length/2),requestAnimationFrame(n=>this.render(n))}handleResize(){super.resizeCanvas();let e=this.assets.uniforms.get(`${this.assets.uniformPrefix}resolution`)??null;if(!e){console.warn(`Could not find resolution uniform (${this.assets.uniformPrefix}resolution) location when resizing canvas`);return}this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.uniform2f(e.location,this.canvas.width,this.canvas.height)}addEventListeners(){let{signal:e}=this.controller;this.canvas.addEventListener("mousemove",t=>{let s=this.canvas.getBoundingClientRect();this.mousePos[0]=t.clientX-s.left,this.mousePos[1]=s.height-(t.clientY-s.top)},{signal:e}),this.canvas.addEventListener("touchmove",t=>{let{clientX:s,clientY:n}=t.touches[0],o=this.canvas.getBoundingClientRect();this.mousePos[0]=s-o.left,this.mousePos[1]=o.height-(n-o.top)},{signal:e}),window.addEventListener("resize",()=>this.handleResize(),{signal:e})}play(){this.rafId=requestAnimationFrame(e=>this.render(e))}pause(){typeof this.rafId=="number"&&(cancelAnimationFrame(this.rafId),this.rafId=null)}updateUniform(e,t){this.assets.setUniformValue(e,t)}destroy(){super.destroy(),this.assets.destroy(),this.controller.abort()}};export{p as default};
//# sourceMappingURL=index.js.map